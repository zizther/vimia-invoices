var f=Object.defineProperty;var r=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var u=(y,c,i)=>c in y?f(y,c,{enumerable:!0,configurable:!0,writable:!0,value:i}):y[c]=i,p=(y,c)=>{for(var i in c||(c={}))g.call(c,i)&&u(y,i,c[i]);if(r)for(var i of r(c))w.call(c,i)&&u(y,i,c[i]);return y};import{G as v,I as _,a as d,d as N}from"./vendor.01d0adc5.js";import{b as S,h as m,u as h}from"./main.c43fbacd.js";var P={maxPayableAmount:Number.MAX_SAFE_INTEGER,selectedCustomer:"",currency:null,currency_id:"",customer_id:"",payment_number:"",payment_date:"",amount:0,invoice_id:"",notes:"",payment_method_id:"",customFields:[],fields:[]};const I=(y=!1)=>{const c=y?window.pinia.defineStore:N,{global:i}=window.i18n;return c({id:"payment",state:()=>({payments:[],paymentTotalCount:0,selectAllField:!1,selectedPayments:[],selectedNote:null,showExchangeRate:!1,drivers:[],providers:[],paymentProviders:{id:null,name:"",driver:"",active:!1,settings:{key:"",secret:""}},currentPayment:p({},P),paymentModes:[],currentPaymentMode:{id:"",name:null},isFetchingInitialData:!1}),getters:{isEdit:t=>!!t.paymentProviders.id},actions:{fetchPaymentInitialData(t){const n=S(),s=v();this.isFetchingInitialData=!0;let e=[];t&&(e=[this.fetchPayment(s.params.id)]),Promise.all([this.fetchPaymentModes({limit:"all"}),this.getNextNumber(),...e]).then(async([a,l,o])=>{t?o.data.data.invoice&&(this.currentPayment.maxPayableAmount=parseInt(o.data.data.invoice.due_amount)):!t&&l.data&&(this.currentPayment.payment_date=_().format("YYYY-MM-DD"),this.currentPayment.payment_number=l.data.nextNumber,this.currentPayment.currency=n.selectedCompanyCurrency),this.isFetchingInitialData=!1}).catch(a=>{m(a)})},fetchPayments(t){return new Promise((n,s)=>{d.get("/api/v1/payments",{params:t}).then(e=>{this.payments=e.data.data,this.paymentTotalCount=e.data.meta.payment_total_count,n(e)}).catch(e=>{m(e),s(e)})})},fetchPayment(t){return new Promise((n,s)=>{d.get(`/api/v1/payments/${t}`).then(e=>{Object.assign(this.currentPayment,e.data.data),n(e)}).catch(e=>{m(e),s(e)})})},addPayment(t){return new Promise((n,s)=>{d.post("/api/v1/payments",t).then(e=>{this.payments.push(e.data),h().showNotification({type:"success",message:i.t("payments.created_message")}),n(e)}).catch(e=>{m(e),s(e)})})},updatePayment(t){return new Promise((n,s)=>{d.put(`/api/v1/payments/${t.id}`,t).then(e=>{if(e.data){let a=this.payments.findIndex(o=>o.id===e.data.data.id);this.payments[a]=t.payment,h().showNotification({type:"success",message:i.t("payments.updated_message")})}n(e)}).catch(e=>{m(e),s(e)})})},deletePayment(t){const n=h();return new Promise((s,e)=>{d.post("/api/v1/payments/delete",t).then(a=>{let l=this.payments.findIndex(o=>o.id===t);this.payments.splice(l,1),n.showNotification({type:"success",message:i.t("payments.deleted_message",1)}),s(a)}).catch(a=>{m(a),e(a)})})},deleteMultiplePayments(){const t=h();return new Promise((n,s)=>{d.post("/api/v1/payments/delete",{ids:this.selectedPayments}).then(e=>{this.selectedPayments.forEach(a=>{let l=this.payments.findIndex(o=>o.id===a.id);this.payments.splice(l,1)}),t.showNotification({type:"success",message:i.tc("payments.deleted_message",2)}),n(e)}).catch(e=>{m(e),s(e)})})},setSelectAllState(t){this.selectAllField=t},selectPayment(t){this.selectedPayments=t,this.selectedPayments.length===this.payments.length?this.selectAllField=!0:this.selectAllField=!1},selectAllPayments(){if(this.selectedPayments.length===this.payments.length)this.selectedPayments=[],this.selectAllField=!1;else{let t=this.payments.map(n=>n.id);this.selectedPayments=t,this.selectAllField=!0}},selectNote(t){this.selectedNote=null,this.selectedNote=t},resetSelectedNote(t){this.selectedNote=null},searchPayment(t){return new Promise((n,s)=>{d.get("/api/v1/payments",{params:t}).then(e=>{this.payments=e.data,n(e)}).catch(e=>{m(e),s(e)})})},previewPayment(t){return new Promise((n,s)=>{d.get(`/api/v1/payments/${t.id}/send/preview`,{params:t}).then(e=>{n(e)}).catch(e=>{m(e),s(e)})})},sendEmail(t){return new Promise((n,s)=>{d.post(`/api/v1/payments/${t.id}/send`,t).then(e=>{n(e)}).catch(e=>{m(e),s(e)})})},getNextNumber(t,n=!1){return new Promise((s,e)=>{d.get("/api/v1/next-number?key=payment",{params:t}).then(a=>{n&&(this.currentPayment.payment_number=a.data.nextNumber),s(a)}).catch(a=>{m(a),e(a)})})},resetCurrentPayment(){this.currentPayment=p({},P)},fetchPaymentModes(t){return new Promise((n,s)=>{d.get("/api/v1/payment-methods",{params:t}).then(e=>{this.paymentModes=e.data.data,n(e)}).catch(e=>{m(e),s(e)})})},fetchPaymentMode(t){return new Promise((n,s)=>{d.get(`/api/v1/payment-methods/${t}`).then(e=>{this.currentPaymentMode=e.data.data,n(e)}).catch(e=>{m(e),s(e)})})},addPaymentMode(t){const n=h();return new Promise((s,e)=>{d.post("/api/v1/payment-methods",t).then(a=>{this.paymentModes.push(a.data.data),n.showNotification({type:"success",message:i.t("settings.payment_modes.payment_mode_added")}),s(a)}).catch(a=>{m(a),e(a)})})},updatePaymentMode(t){const n=h();return new Promise((s,e)=>{d.put(`/api/v1/payment-methods/${t.id}`,t).then(a=>{if(a.data){let l=this.paymentModes.findIndex(o=>o.id===a.data.data.id);this.paymentModes[l]=t.paymentModes,n.showNotification({type:"success",message:i.t("settings.payment_modes.payment_mode_updated")})}s(a)}).catch(a=>{m(a),e(a)})})},deletePaymentMode(t){const n=h();return new Promise((s,e)=>{d.delete(`/api/v1/payment-methods/${t}`).then(a=>{let l=this.paymentModes.findIndex(o=>o.id===t);this.paymentModes.splice(l,1),a.data.success&&n.showNotification({type:"success",message:i.t("settings.payment_modes.deleted_message")}),s(a)}).catch(a=>{m(a),e(a)})})}}})()};export{I as u};
