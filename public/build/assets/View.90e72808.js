var re=Object.defineProperty;var C=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var L=(p,c,s)=>c in p?re(p,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[c]=s,M=(p,c)=>{for(var s in c||(c={}))ne.call(c,s)&&L(p,s,c[s]);if(C)for(var s of C(c))ie.call(c,s)&&L(p,s,c[s]);return p};import{J as de,ah as ue,B as f,G as ce,aN as me,a0 as fe,k as B,C as pe,A as _e,r as d,o as m,e as E,f as a,l as g,w as r,h as u,u as l,i as $,t as b,j as v,F as R,y as ye,m as ge}from"./vendor.01d0adc5.js";import{_ as be}from"./EstimateIndexDropdown.cfcd0f93.js";import{c as ve,k as he,u as xe,j as Be,e as Ee,g as z}from"./main.c43fbacd.js";import{_ as ke}from"./SendEstimateModal.a9537aac.js";import{L as Se}from"./LoadingIcon.8e3c4639.js";import"./mail-driver.299d5771.js";const we={class:"mr-3 text-sm"},Te={class:"fixed top-0 left-0 hidden h-full pt-16 pb-4 ml-56 bg-white xl:ml-64 w-88 xl:block"},Ie={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},De={class:"mb-6"},Fe={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},$e={class:"px-4 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},Ve={key:0,class:"h-full pb-32 overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},Ae={class:"flex-2"},je={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},Ne={class:"flex-1 whitespace-nowrap right"},Ce={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},Le={class:"flex justify-center p-4 items-center"},Me={key:0,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Re={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},ze=["src"],We={setup(p){const c=ve(),s=he();xe();const P=Be(),V=Ee(),{t:y}=de();ue("$utils"),f(null),f(null);const i=f(null);f(null);const h=ce();me(),f(["DRAFT","SENT","VIEWED","EXPIRED","ACCEPTED","REJECTED"]);const k=f(!1),U=f(!1);f(!1);const A=f(!1),x=f(!1),S=f(!1),t=fe({orderBy:null,orderByField:null,searchText:null}),G=B(()=>i.value.estimate_number),j=B(()=>t.orderBy==="asc"||t.orderBy==null);B(()=>j.value?y("general.ascending"):y("general.descending"));const H=B(()=>`/estimates/pdf/${i.value.unique_hash}`);B(()=>i.value&&i.value.id?estimate.value.id:null),pe(h,(e,n)=>{e.name==="estimates.view"&&N()}),q(),N(),_=_e.exports.debounce(_,500);function J(e){return h.params.id==e}async function q(){x.value=!0,await s.fetchEstimates(h.params.id),x.value=!1,setTimeout(()=>{O()},500)}function O(){const e=document.getElementById(`estimate-${h.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"))}async function N(){S.value=!0;let e=await s.fetchEstimate(h.params.id);e.data&&(S.value=!1,i.value=M({},e.data.data))}async function _(){let e="";t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(e+=`search=${t.searchText}&`),t.orderBy!==null&&t.orderBy!==void 0&&(e+=`orderBy=${t.orderBy}&`),t.orderByField!==null&&t.orderByField!==void 0&&(e+=`orderByField=${t.orderByField}`),A.value=!0;let n=await s.searchEstimate(e);A.value=!1,n.data&&(s.estimates=n.data.data)}function W(){return t.orderBy==="asc"?(t.orderBy="desc",_(),!0):(t.orderBy="asc",_(),!0)}async function X(){P.openDialog({title:y("general.are_you_sure"),message:y("estimates.confirm_mark_as_sent"),yesLabel:y("general.ok"),noLabel:y("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(e=>{k.value=!1,e&&(s.markAsSent({id:i.value.id,status:"SENT"}),i.value.status="SENT",k.value=!0),k.value=!1})}async function K(e){c.openModal({title:y("estimates.send_estimate"),componentName:"SendEstimateModal",id:i.value.id,data:i.value})}return(e,n)=>{const w=d("BaseButton"),Q=d("BasePageHeader"),T=d("BaseIcon"),Y=d("BaseInput"),I=d("BaseRadio"),D=d("BaseInputGroup"),F=d("BaseDropdownItem"),Z=d("BaseDropdown"),ee=d("BaseText"),te=d("BaseEstimateStatusBadge"),ae=d("BaseFormatMoney"),se=d("router-link"),oe=d("BasePage");return m(),E(R,null,[a(ke),i.value?(m(),g(oe,{key:0,class:"xl:pl-96 xl:ml-8"},{default:r(()=>[a(Q,{title:l(G)},{actions:r(()=>[u("div",we,[i.value.status==="DRAFT"&&l(V).hasAbilities(l(z).EDIT_ESTIMATE)?(m(),g(w,{key:0,disabled:k.value,"content-loading":S.value,variant:"primary-outline",onClick:X},{default:r(()=>[$(b(e.$t("estimates.mark_as_sent")),1)]),_:1},8,["disabled","content-loading"])):v("",!0)]),i.value.status==="DRAFT"&&l(V).hasAbilities(l(z).SEND_ESTIMATE)?(m(),g(w,{key:0,disabled:U.value,"content-loading":S.value,variant:"primary",class:"text-sm",onClick:K},{default:r(()=>[$(b(e.$t("estimates.send_estimate")),1)]),_:1},8,["disabled","content-loading"])):v("",!0),a(be,{class:"ml-3",row:i.value},null,8,["row"])]),_:1},8,["title"]),u("div",Te,[u("div",Ie,[u("div",De,[a(Y,{modelValue:l(t).searchText,"onUpdate:modelValue":n[0]||(n[0]=o=>l(t).searchText=o),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:n[1]||(n[1]=o=>_())},{right:r(()=>[a(T,{name:"SearchIcon",class:"text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),u("div",Fe,[a(Z,{class:"ml-3",position:"bottom-start","width-class":"w-45","position-class":"left-0"},{activator:r(()=>[a(w,{size:"md",variant:"gray"},{default:r(()=>[a(T,{name:"FilterIcon"})]),_:1})]),default:r(()=>[u("div",$e,b(e.$t("general.sort_by")),1),a(F,{class:"flex px-4 py-2 cursor-pointer"},{default:r(()=>[a(D,{class:"-mt-3 font-normal"},{default:r(()=>[a(I,{id:"filter_estimate_date",modelValue:l(t).orderByField,"onUpdate:modelValue":[n[2]||(n[2]=o=>l(t).orderByField=o),_],label:e.$t("reports.estimates.estimate_date"),size:"sm",name:"filter",value:"estimate_date"},null,8,["modelValue","label"])]),_:1})]),_:1}),a(F,{class:"flex px-4 py-2 cursor-pointer"},{default:r(()=>[a(D,{class:"-mt-3 font-normal"},{default:r(()=>[a(I,{id:"filter_due_date",modelValue:l(t).orderByField,"onUpdate:modelValue":[n[3]||(n[3]=o=>l(t).orderByField=o),_],label:e.$t("estimates.due_date"),value:"expiry_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1}),a(F,{class:"flex px-4 py-2 cursor-pointer"},{default:r(()=>[a(D,{class:"-mt-3 font-normal"},{default:r(()=>[a(I,{id:"filter_estimate_number",modelValue:l(t).orderByField,"onUpdate:modelValue":[n[4]||(n[4]=o=>l(t).orderByField=o),_],label:e.$t("estimates.estimate_number"),value:"estimate_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),a(w,{class:"ml-1",size:"md",variant:"gray",onClick:W},{default:r(()=>[l(j)?(m(),g(T,{key:0,name:"SortAscendingIcon"})):(m(),g(T,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),l(s)&&l(s).estimates?(m(),E("div",Ve,[(m(!0),E(R,null,ye(l(s).estimates,(o,le)=>(m(),E("div",{key:le},[o&&!x.value?(m(),g(se,{key:0,id:"estimate-"+o.id,to:`/admin/estimates/${o.id}/view`,class:ge(["flex justify-between side-estimate p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":J(o.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:r(()=>[u("div",Ae,[a(ee,{text:o.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),u("div",je,b(o.estimate_number),1),a(te,{status:o.status,class:"px-1 text-xs"},{default:r(()=>[$(b(o.status),1)]),_:2},1032,["status"])]),u("div",Ne,[a(ae,{amount:o.total,currency:o.customer.currency,class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900"},null,8,["amount","currency"]),u("div",Ce,b(o.formatted_estimate_date),1)])]),_:2},1032,["id","to","class"])):v("",!0)]))),128)),u("div",Le,[x.value?(m(),g(Se,{key:0,class:"h-6 m-1 animate-spin text-primary-400"})):v("",!0)]),!l(s).estimates.length&&!x.value?(m(),E("p",Me,b(e.$t("estimates.no_matching_estimates")),1)):v("",!0)])):v("",!0)]),u("div",Re,[u("iframe",{src:`${l(H)}`,class:"flex-1 border border-gray-400 border-solid rounded-md bg-white frame-style"},null,8,ze)])]),_:1})):v("",!0)],64)}}};export{We as default};
